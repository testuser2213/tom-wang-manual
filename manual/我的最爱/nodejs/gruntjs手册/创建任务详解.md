# 创建任务详解 #
By Tom.Wang<tom.wang.sz@qq.com\>

## 概述 ##
1、任务是Grunt的最基本单位  
2、直接调用`grunt`，如果这个时候有一个default任务，则它会得到执行  

## 别名任务（Alias Tasks） ##
1、语法：`grunt.registerTask(taskName, [description, ] taskList)`  
2、执行taskName时，taskList按顺序执行  

## 多Target任务（Multi Task） ##
1、大部分grunt-contrib-xxx任务都是Multi任务  
2、语法：`grunt.registerMultiTask(taskName, [description, ] taskFunction)`  
3、例子：
<pre>
grunt.initConfig({
  log: {
    foo: [1, 2, 3],
    bar: 'hello world',
    baz: false
  }
});

grunt.registerMultiTask('log', 'Log stuff.', function() {
  grunt.log.writeln(this.target + ': ' + this.data);
});
</pre>

## 基本任务（"Basic" Tasks） ##
1、基本任务运行时，不读取配置，仅调用指定的taskFunction，可以传递任意多个参数  
2、语法：`grunt.registerTask(taskName, [description, ] taskFunction)`  
3、例子：
调用`grunt foo:testing:123`输出“foo, testing 123”，调用`grunt foo`输出“foo, no args”  
<pre>
grunt.registerTask('foo', 'A sample task that logs stuff.', function(arg1, arg2) {
  if (arguments.length === 0) {
    grunt.log.writeln(this.name + ", no args");
  } else {
    grunt.log.writeln(this.name + ", " + arg1 + " " + arg2);
  }
});
</pre>

## 自定义任务（Custom Task） ##
1、以下是一个简单的自定义任务  
<pre>
grunt.registerTask('default', 'My "default" task description.', function() {
  grunt.log.writeln('Currently running the "default" task.');
});
</pre>
2、可以在自定义任务里运行其他任务  
<pre>
grunt.registerTask('foo', 'My "foo" task.', function() {
  // Enqueue "bar" and "baz" tasks, to run after "foo" finishes, in-order.
  grunt.task.run('bar', 'baz');
  // Or:
  grunt.task.run(['bar', 'baz']);
});
</pre>
3、任务可以是异步的  
<pre>
grunt.registerTask('asyncfoo', 'My "asyncfoo" task.', function() {
  // Force task into async mode and grab a handle to the "done" function.
  var done = this.async();
  // Run some sync stuff.
  grunt.log.writeln('Processing task...');
  // And some async stuff.
  setTimeout(function() {
    grunt.log.writeln('All done!');
	// done(false)表示任务执行失败
    done();
  }, 1000);
});
</pre>
4、任务可以访问到他们的name和arguments  
<pre>
grunt.registerTask('foo', 'My "foo" task.', function(a, b) {
  grunt.log.writeln(this.name, a, b);
});

// Usage:
// grunt foo foo:bar
//   logs: "foo", undefined, undefined
//   logs: "foo", "bar", undefined
// grunt foo:bar:baz
//   logs: "foo", "bar", "baz"
</pre>
5、出错时控制任务失败  
<pre>
grunt.registerTask('foo', 'My "foo" task.', function() {
  if (failureOfSomeKind) {
    grunt.log.error('This is an error message.');
  }

  // Fail by returning false if this task had errors
  if (ifErrors) { return false; }

  grunt.log.writeln('This is the success message');
});
</pre>
6、当任务失败时，所有子任务都会停止执行，除非使用--force选项  
<pre>
grunt.registerTask('foo', 'My "foo" task.', function() {
  // Fail synchronously.
  return false;
});

grunt.registerTask('bar', 'My "bar" task.', function() {
  var done = this.async();
  setTimeout(function() {
    // Fail asynchronously.
    done(false);
  }, 1000);
});
</pre>
7、任务可以依赖其他任务的成功执行，`grunt.task.requires`不会真正去执行任务，它只是检查任务是否执行并且成功地执行了  
<pre>
grunt.registerTask('foo', 'My "foo" task.', function() {
  return false;
});

grunt.registerTask('bar', 'My "bar" task.', function() {
  // Fail task if "foo" task failed or never ran.
  grunt.task.requires('foo');
  // This code executes if the "foo" task ran successfully.
  grunt.log.writeln('Hello, world.');
});

// Usage:
// grunt foo bar
//   doesn't log, because foo failed.
// grunt bar
//   doesn't log, because foo never ran.
</pre>
8、任务可以依赖指定的配置是否存在，使用`grunt.config.requires`  
<pre>
grunt.registerTask('foo', 'My "foo" task.', function() {
  // Fail task if "meta.name" config prop is missing.
  grunt.config.requires('meta.name');
  // Also fails if "meta.name" config prop is missing.
  grunt.config.requires(['meta', 'name']);
  // Log... conditionally.
  grunt.log.writeln('This will only log if meta.name is defined in the config.');
});
</pre>
9、任务可以访问配置信息  
<pre>
grunt.registerTask('foo', 'My "foo" task.', function() {
  // Log the property value. Returns null if the property is undefined.
  grunt.log.writeln('The meta.name property is: ' + grunt.config('meta.name'));
  // Also logs the property value. Returns null if the property is undefined.
  grunt.log.writeln('The meta.name property is: ' + grunt.config(['meta', 'name']));
});
</pre>
10、查看[contrib tasks](https://github.com/gruntjs/)获取更多实例

## ChangeLog ##
2013年06月19日 新建文档  